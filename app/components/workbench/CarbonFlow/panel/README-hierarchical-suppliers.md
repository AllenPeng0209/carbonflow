# 多级供应商清单功能说明

## 功能概述

多级供应商清单功能允许您在排放源清单中建立层级关系，支持产品的组成结构展示。例如：
- 产品A由产品B、C组成
- 产品B又由产品D、E组成
- 支持无限层级的供应商关系

## 主要特性

### 1. 层级展示
- **树形结构**：支持展开/折叠查看子级供应商
- **缩进显示**：不同层级通过缩进区分
- **视觉标识**：不同层级有不同的背景色和边框

### 2. 供应商分级
- **1级供应商**：直接供应商（绿色标识）
- **2级供应商**：间接供应商（黄色标识）
- **3级供应商**：更深层供应商（橙色标识）

### 3. 组成关系
- **复合产品标识**：显示哪些产品由其他产品组成
- **组成比例**：显示子产品在父产品中的占比
- **供应商信息**：显示供应商名称、层级、是否直供等

### 4. 添加子级功能 ✨ 新增
- **一键添加子级**：点击操作栏中的"添加子级"按钮
- **自动层级计算**：系统自动计算子级的层级和供应商等级
- **智能默认值**：继承父级的生命周期阶段和排放类型
- **即时编辑**：添加后自动打开编辑界面进行详细配置

## 数据结构

### 节点数据字段

```typescript
interface NodeData {
  // 层级关系字段
  parentNodeId?: string;        // 父节点ID
  childNodeIds?: string[];      // 子节点ID数组
  level?: number;               // 层级深度（0为顶级）
  isComposite?: boolean;        // 是否为复合产品
  compositionRatio?: number;    // 组成比例（0-1）
  supplierTier?: number;        // 供应商层级
  
  // 供应商信息
  supplierInfo?: {
    name?: string;              // 供应商名称
    tier: number;               // 供应商层级
    isDirectSupplier: boolean;  // 是否为直接供应商
    parentSupplierId?: string;  // 上级供应商ID
  };
}
```

## 使用方法

### 1. 创建层级关系

```typescript
// 父产品
const parentProduct = {
  id: 'product-a',
  data: {
    label: '智能手机',
    level: 0,
    isComposite: true,
    childNodeIds: ['screen-001', 'battery-001'],
    supplierInfo: {
      name: '手机制造商',
      tier: 1,
      isDirectSupplier: true
    }
  }
};

// 子产品
const childProduct = {
  id: 'screen-001',
  data: {
    label: 'OLED显示屏',
    level: 1,
    parentNodeId: 'product-a',
    compositionRatio: 0.3, // 占父产品30%
    supplierInfo: {
      name: '显示屏供应商',
      tier: 2,
      isDirectSupplier: false
    }
  }
};
```

### 2. 添加子级操作步骤

1. **选择父节点**：在表格中找到要添加子级的产品
2. **点击添加子级**：点击操作栏中的 ➕ "添加子级"按钮
3. **系统自动处理**：
   - 自动生成子节点ID
   - 计算层级深度（父级+1）
   - 设置供应商层级（父级+1）
   - 继承父级的生命周期阶段
   - 设置默认组成比例（10%）
4. **编辑详细信息**：系统自动打开编辑界面，可以修改：
   - 产品名称
   - 组成比例
   - 供应商信息
   - 活动数据
   - 排放因子等

### 3. 操作功能

- **展开/折叠**：点击箭头图标展开或折叠子级
- **展开全部**：一键展开所有层级
- **折叠全部**：一键折叠所有层级
- **添加子级**：为现有产品添加子级供应商 ✨
- **编辑/删除**：标准的编辑和删除操作

### 4. 视觉标识

- **🏢 复合产品图标**：表示该产品由其他产品组成
- **👤 供应商图标**：表示该节点有供应商信息
- **层级标签**：显示供应商层级（1级、2级、3级）
- **比例标签**：显示在父产品中的组成比例

## 样式说明

### 层级背景色
- **1级**：#f9f9f9（浅灰）
- **2级**：#f0f0f0（中灰）
- **3级**：#e8e8e8（深灰）

### 供应商层级边框
- **1级供应商**：绿色左边框
- **2级供应商**：黄色左边框
- **3级供应商**：橙色左边框

### 标签颜色
- **1级供应商**：蓝色标签
- **2级供应商**：绿色标签
- **3级供应商**：橙色标签
- **组成比例**：紫色标签

## 示例场景

### 智能手机供应链
```
智能手机 (1级供应商)
├── OLED显示屏 (2级供应商, 30%)
│   ├── 强化玻璃 (3级供应商, 40%)
│   └── OLED面板 (3级供应商, 60%)
├── 锂离子电池 (2级供应商, 25%)
│   ├── 锂金属 (3级供应商, 30%)
│   └── 钴金属 (3级供应商, 25%)
└── 芯片处理器 (2级供应商, 20%)
    ├── 硅晶圆 (3级供应商)
    └── 稀土元素 (3级供应商)
```

### 添加子级的实际操作流程

1. **场景**：为"智能手机"添加"摄像头模组"子级
2. **操作**：
   - 在表格中找到"智能手机"行
   - 点击操作栏的 ➕ "添加子级"按钮
   - 系统自动创建子节点并打开编辑界面
3. **配置**：
   - 修改名称为"摄像头模组"
   - 设置组成比例为15%
   - 配置供应商信息
   - 填写活动数据和排放因子
4. **结果**：
   - 父节点自动标记为复合产品
   - 子节点出现在层级结构中
   - 可以继续为子节点添加更深层级

## 最佳实践

1. **合理设置层级**：建议不超过4-5层，避免过于复杂
2. **准确的比例**：确保同级子产品的比例总和合理
3. **完整的供应商信息**：填写准确的供应商名称和层级
4. **清晰的命名**：使用易于理解的产品和供应商名称
5. **逐步构建**：先建立主要组件，再逐步细化子级

## 技术实现

- **React Hooks**：使用useState管理展开状态
- **递归算法**：构建层级数据结构
- **Ant Design Table**：支持自定义行样式和渲染
- **CSS样式**：层级视觉效果和动画
- **数据持久化**：自动保存到数据库

## 注意事项

1. **数据一致性**：添加子级时会自动更新父节点的复合产品标识
2. **层级限制**：虽然支持无限层级，但建议控制在合理范围内
3. **性能考虑**：大量节点时建议分批加载或使用虚拟滚动
4. **数据备份**：重要数据建议定期备份

这个功能大大提升了供应链可视化的能力，帮助用户更好地理解和管理复杂的供应商关系。 